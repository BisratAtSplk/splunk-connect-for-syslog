name: Test Matrix

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        syslog-version: [3.25.1,master]
        splunk-version: [7.2,7.3,8.0,edge]

    steps:
    - name: Checkout private tools
      uses: actions/checkout@v2
      - uses: azure/docker-login@v1
        with:
          login-server: docker.pkg.github.com
          username: ${{ secrets.GitHub_User }}
          password: ${{ secrets.GitHub_PAT }}

    - name: Set up Python
      uses: actions/setup-python@v1
      with:
        python-version: 3.7
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r tests/requirements.txt
    - name: Test with pytest
      run: |
        pip install pytest
        pytest -v \
          --rootdir=$(pwd) \
          --splunk_type=docker \
          --splunk_version=${{ matrix.splunk-version }} \
          --splunk_password=Changed@11
